<app-officer-layout>
    <!-- SEARCH -->
    <div class="search-bar">
        <input
            class="search-input"
            [(ngModel)]="trackingId"
            placeholder="Tracking ID"
        />
        <button class="btn" (click)="searchTracking()">Track</button>
        <button class="btn secondary" (click)="resetSearch()">Reset</button>
    </div>

    @if (trackingData()!) {
    <div class="header-card">
        <div class="header-block">
            <h3>Sender</h3>
            <p>{{ trackingData()!.senderDetails.name }}</p>
            <p>{{ trackingData()!.senderDetails.phone }}</p>
            <p>{{ trackingData()!.senderDetails.email }}</p>
            <p>
                {{ trackingData()!.senderDetails.houseNo }},
                {{ trackingData()!.senderDetails.addressLine1 }},
                {{ trackingData()!.senderDetails.addressLine2 }},
                {{ trackingData()!.senderDetails.landmark }},
                {{ trackingData()!.senderDetails.city }},
                {{ trackingData()!.senderDetails.state }} -
                {{ trackingData()!.senderDetails.pincode }},
                {{ trackingData()!.senderDetails.country }}
            </p>
        </div>

        <div class="header-block">
            <h3>Parcel</h3>
            <p>Tracking ID: {{ trackingData()!.trackingId }}</p>
            <p>Booking ID: {{ trackingData()!.bookingId }}</p>
            <p>Status: {{ trackingData()!.currentStatus }}</p>
            <p>Weight: {{ trackingData()!.parcelDetails.weightInGrams }} g</p>
            <p>Packaging: {{ trackingData()!.parcelDetails.packagingType }}</p>
            <p>
                Delivery Type: {{ trackingData()!.parcelDetails.deliveryType }}
            </p>
        </div>

        <div class="header-block">
            <h3>Receiver</h3>
            <p>{{ trackingData()!.receiverDetails.name }}</p>
            <p>{{ trackingData()!.receiverDetails.phoneNumber }}</p>
            <p>{{ trackingData()!.receiverDetails.alternatePhoneNumber }}</p>
            <p>{{ trackingData()!.receiverDetails.email }}</p>
            <p>
                {{ trackingData()!.receiverDetails.houseNo }},
                {{ trackingData()!.receiverDetails.addressLine1 }},
                {{ trackingData()!.receiverDetails.addressLine2 }},
                {{ trackingData()!.receiverDetails.landmark }},
                {{ trackingData()!.receiverDetails.city }},
                {{ trackingData()!.receiverDetails.state }} -
                {{ trackingData()!.receiverDetails.pincode }},
                {{ trackingData()!.receiverDetails.country }}
            </p>
        </div>
    </div>
    } @if (trackingData()!) {
    <div class="main-grid">
        <div class="card">
            <h3>Tracking Details</h3>
            <p>Current Location: {{ trackingData()!.currentLocation }}</p>
            <p>
                Estimated Delivery:
                {{ trackingData()!.estimatedDeliveryDate | date }}
            </p>
            <p>Progress: {{ trackingData()!.progressPercentage }}%</p>

            @for (s of trackingData()!.statusHistory; track $index) {
            <div class="timeline" [class.done]="s.completed">
                <span></span>
                <div>
                    <strong>{{ s.label }}</strong>
                    <p>{{ s.timestamp | date : "short" }} | {{ s.location }}</p>
                    <p>{{ s.description }}</p>
                </div>
            </div>
            }
        </div>

        <div class="card">
            <h3>Payment Details</h3>
            <p>
                Transaction: {{ trackingData()!.paymentDetails.transactionId }}
            </p>
            <p>Status: {{ trackingData()!.paymentDetails.paymentStatus }}</p>
            <p>Method: {{ trackingData()!.paymentDetails.paymentMethod }}</p>
            <p>Base Rate: ₹{{ trackingData()!.paymentDetails.baseRate }}</p>
            <p>
                Packaging: ₹{{ trackingData()!.paymentDetails.packagingRate }}
            </p>
            <p>Admin Fee: ₹{{ trackingData()!.paymentDetails.adminFee }}</p>
            <p>
                Weight Charge: ₹{{
                    trackingData()!.paymentDetails.weightCharge
                }}
            </p>
            <p>
                Delivery Charge: ₹{{
                    trackingData()!.paymentDetails.deliveryCharge
                }}
            </p>
            <p>Tax: ₹{{ trackingData()!.paymentDetails.taxAmount }}</p>
            <p>
                <strong
                    >Total: ₹{{
                        trackingData()!.paymentDetails.finalAmount
                    }}</strong
                >
            </p>
            <p>
                Card: {{ trackingData()!.paymentDetails.cardBrand }} •
                {{ trackingData()!.paymentDetails.cardLastFour }}
            </p>
            <p>
                Card Holder: {{ trackingData()!.paymentDetails.cardHolderName }}
            </p>
        </div>
    </div>
    }
</app-officer-layout>
